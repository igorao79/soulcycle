# Настройка Supabase для проекта SoulCycle

В этом документе описаны шаги для настройки Supabase и интеграции его с проектом SoulCycle.

## 1. Создание таблиц в Supabase

Откройте SQL Editor в панели управления Supabase и выполните SQL запросы из файла `supabase_tables.sql`. Эти запросы создадут все необходимые таблицы, триггеры и политики доступа.

## 2. Структура базы данных

База данных содержит следующие таблицы:

1. **posts** - Посты пользователей
   - `id` - Уникальный идентификатор поста
   - `content` - Текст поста
   - `image_url` - URL изображения (опционально)
   - `user_id` - ID автора поста
   - `created_at` - Дата создания
   - `updated_at` - Дата обновления

2. **post_likes** - Лайки постов
   - `id` - Уникальный идентификатор лайка
   - `post_id` - ID поста
   - `user_id` - ID пользователя, поставившего лайк
   - `created_at` - Дата создания

3. **post_comments** - Комментарии к постам
   - `id` - Уникальный идентификатор комментария
   - `content` - Текст комментария
   - `post_id` - ID поста
   - `user_id` - ID автора комментария
   - `created_at` - Дата создания
   - `updated_at` - Дата обновления

4. **profiles** - Профили пользователей
   - `id` - ID пользователя (совпадает с ID из auth.users)
   - `display_name` - Отображаемое имя пользователя
   - `avatar` - URL аватара
   - `role` - Роль пользователя (user, admin)
   - `created_at` - Дата создания
   - `updated_at` - Дата обновления

## 3. Настройка аутентификации

В разделе Authentication настройте Email Auth:

1. Перейдите в раздел Authentication -> Providers
2. Убедитесь, что Email provider включен
3. В настройках Email provider:
   - Email confirmations: `Disabled` (для тестирования)
   - Secure email change: `Enabled`
   - Custom SMTP server: по вашему усмотрению

## 4. Настройка URL и безопасности

В разделе Authentication -> URL Configuration:

1. Добавьте URL вашего приложения (например, `http://localhost:5173`)
2. Добавьте URL перенаправлений (например, `http://localhost:5173/*, http://localhost:5173`)

## 5. Настройка Row Level Security (RLS)

RLS уже настроена при выполнении запросов из `supabase_tables.sql`. Правила RLS контролируют доступ к данным на уровне строк:

1. Все могут читать посты, лайки, комментарии и профили
2. Пользователи могут создавать/обновлять/удалять только свои собственные данные
3. Пользователи не могут изменять чужие данные

## 6. Ключи API Supabase

В настройках проекта:

1. Project Settings -> API
2. Скопируйте `URL` и `anon public key`
3. Вставьте их в файл `src/services/supabaseClient.js`

## 7. Тестирование

После настройки базы данных и аутентификации:

1. Зарегистрируйте тестового пользователя
2. Проверьте создание поста
3. Убедитесь, что работают лайки и комментарии
4. Проверьте, что данные сохраняются между сессиями

## 8. Дополнительные настройки

По мере необходимости вы можете:

1. Добавить дополнительные индексы для оптимизации запросов
2. Настроить хранилище для загрузки изображений (Storage)
3. Добавить функции поиска
4. Реализовать реальновременные обновления через Supabase Realtime

## Заключение

Теперь в вашем проекте реализовано:
- Хранение данных пользователей, постов, комментариев и лайков в Supabase
- Аутентификация пользователей через Supabase Auth
- Правила безопасности, ограничивающие доступ к данным 