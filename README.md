# SoulCycle React App

Приложение SoulCycle на React с интеграцией Supabase для аутентификации и хранения данных.

## О проекте

SoulCycle - это социальная платформа, которая позволяет пользователям делиться контентом, общаться и участвовать в обсуждениях через посты и комментарии.

## Технологии

- **Frontend**: React 19, Vite, CSS
- **База данных и аутентификация**: Supabase
- **State Management**: React Hooks и Context API
- **Медиа хранилище**: Cloudinary для загрузки и управления изображениями
- **Backend API**: 
  - Основной API: https://scapi-dj82ynavq-igors-projects-f86e1b8f.vercel.app
  - Cloudinary API: https://cloudinary-api-uapz.onrender.com
- **Deployment**: GitHub Pages

## Интеграция с Cloudinary

Приложение использует Cloudinary для хранения и оптимизации изображений. Для обеспечения безопасного удаления изображений используется микросервис на Render:

- **API Endpoints**:
  - `GET /api/health` - проверка работоспособности сервера
  - `POST /api/cloudinary/delete` - удаление изображения
  - `POST /api/cloudinary/delete-multiple` - пакетное удаление изображений

## Система автоматического обновления кэша

Приложение включает механизм автоматического обновления кэша у пользователей при выпуске новой версии:

1. Каждый деплой автоматически обновляет файл `version.json` с номером версии и временной меткой
2. При загрузке приложения компонент `VersionChecker` сравнивает версию из `version.json` с сохраненной локально
3. Если версии отличаются, происходит автоматическая очистка кэша в браузере и localStorage
4. Страница перезагружается для применения новой версии

### Работа с версиями

Для обновления версии используйте:

```bash
# Обновление патч-версии (1.0.0 -> 1.0.1)
npm run update-version

# Обновление минорной версии (1.0.0 -> 1.1.0)
npm run update-version:minor

# Обновление мажорной версии (1.0.0 -> 2.0.0)
npm run update-version:major
```

## Настройка проекта

### Переменные среды

Создайте файл `.env` на основе `.env.example` и добавьте свои ключи Supabase и Cloudinary:

```
VITE_SUPABASE_URL=your_supabase_url_here
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key_here
VITE_API_URL=https://scapi-dj82ynavq-igors-projects-f86e1b8f.vercel.app
VITE_CLOUDINARY_API_SERVER=https://cloudinary-api-uapz.onrender.com
VITE_CLOUDINARY_CLOUD_NAME=do9t8preg
VITE_CLOUDINARY_API_KEY=417482147356551
VITE_CLOUDINARY_UPLOAD_PRESET=postss
```

### Установка и запуск

```bash
# Установка зависимостей
npm install

# Запуск в режиме разработки
npm run dev

# Сборка для продакшена
npm run build

# Деплой на GitHub Pages
npm run deploy
```

## Структура API сервиса

### Основной API

Сервис API предоставляет следующие методы:

#### Посты
- `getPosts(options)` - получение списка постов с пагинацией и сортировкой
- `getPost(postId)` - получение конкретного поста
- `createPost(postData)` - создание нового поста
- `updatePost(postId, postData)` - обновление поста
- `deletePost(postId)` - удаление поста

#### Комментарии
- `getComments(postId, options)` - получение комментариев к посту
- `createComment(postId, content)` - создание комментария
- `updateComment(postId, commentId, content)` - обновление комментария
- `deleteComment(postId, commentId)` - удаление комментария

#### Лайки
- `likePost(postId)` - поставить лайк посту
- `unlikePost(postId)` - убрать лайк с поста
- `isPostLiked(postId)` - проверить, лайкнул ли пользователь пост
- `getPostLikers(postId, options)` - получить список пользователей, лайкнувших пост

#### Пользователи
- `getUser(userId)` - получить данные пользователя
- `getMe()` - получить данные текущего пользователя
- `updateUser(userData)` - обновить данные пользователя
- `syncUser()` - синхронизировать данные пользователя после входа

### Сервис обратной связи

Приложение использует отдельный сервис для обработки обратной связи от пользователей, размещенный на Render:

**URL**: `https://scform.onrender.com/api/feedback`

**Endpoints**:
- `POST /api/feedback` - отправка формы обратной связи
  - Принимает `FormData` с полями:
    - `message` - текст сообщения
    - `email` - email пользователя
    - `displayName` - имя пользователя
    - `images` - прикрепленные изображения (множественная загрузка)

## Обновления

⭐ Апдейт 6.0:

• Добавлен отдельный API сервер для Cloudinary на Render
• Улучшена работа с изображениями
• Добавлены оптимизированные компоненты для отображения изображений

⭐ Апдейт 5.6:

• Добавлена система автоматического обновления кэша у пользователей
• Добавлена улучшенная система кэширования данных

⭐ Апдейт 5.5:

• Небольшие оптимизационные изменения

⭐ Апдейт 5:

• Добавлена ночная тема
• Добавлен новый раздел (пока в процессе разработки)

⭐ Апдейт 4:

• Визуальное улучшение проекта
• Добавление основной странички сайта

⭐ Апдейт 3:

• Визуальное улучшение проекта
• Разделение лора по страницам + переключение внутри модального окна
• Оптимизация проекта

⭐ Апдейт 2:

• Добавлено модальное окно для чтения лора

⭐ Апдейт 1:

• Добавлены карточки персонажей
• Добавлена возможность переключения карточек

## Архитектура приложения

### Фронтенд
- React 19 с хуками и оптимизированным рендерингом
- Supabase для аутентификации и хранения данных
- Vite для сборки
- React Router для маршрутизации
- Взаимодействие с API через fetch
- Cloudinary для управления медиа-контентом

### Бэкенды
- **Основной бэкенд** выделен в отдельный проект и размещен на Vercel
- **Cloudinary API сервер** размещен на Render
- **Сервис обратной связи** размещен на Render

## Структура проекта
- `/src` - исходные файлы React приложения
- `/public` - статические файлы
- `/dist` - сборка проекта (генерируется автоматически)
